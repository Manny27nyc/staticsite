{% macro inline_page(page) -%}
<div class="card mb-4">
  <div class="card-header">
    <h3><a href="{{url_for(page)}}">{{page.meta.title}}</a></h3>
  </div>
  <div class="card-body">
    {{page.content_short|safe}}
  </div>
  <div class="card-footer text-muted d-flex justify-content-between align-items-center">
    <div>
      <small><a href="{{url_for(page)}}">{{page.meta.date.strftime("%Y-%m-%d")}}</a></small>
    </div>
    <div class="text-right">
    {% for tag in page.meta.tags %}
    <a class="badge badge-pill badge-primary" href="{{ url_for(tag) }}" class="label label-default">{{tag.name}}</a>
    {% endfor %}
    </div>
  </div>
</div>
{%- endmacro %}

{% macro main_link() -%}
  {% if page.created_from %}
  <div class="card mb-2">
    <div class="card-header">
      <a href="{{url_for(page.created_from)}}">{{page.created_from.meta.title}}</a>
    </div>
  </div>
  {% endif %}
{%- endmacro %}

{% macro archive_link() -%}
  {% if page.meta.related.archive %}
  <div class="card mb-2">
    <div class="card-header">
      <a href="{{url_for(page.meta.related.archive)}}">Archive</a>
    </div>
  </div>
  {% endif %}
{%- endmacro %}

{% macro top_tags(limit=15) -%}
{% with tags = taxonomy("tags") %}
  {% if tags %}
  <div class="card mb-2">
    <div class="card-header">
      <a href="{{url_for(tags)}}">Top {{limit}} tags</a>
    </div>
    <div class="card-body">
      {% for category_page in tags.top_categories(15) %}
      <a class="badge badge-pill badge-primary" href="{{url_for(category_page)}}">{{category_page.name}}
        <span class="badge badge-light">{{category_page.meta.pages|length}}</span>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}
{% endwith %}
{%- endmacro %}

{% macro recent_series(limit=5) %}
{% with series = taxonomy("series") %}
  {% if series %}
  <div class="card mb-2">
    <div class="card-header">
      <a href="{{url_for(series)}}">Recent series</a>
    </div>
    <ul class="list-group list-group-flush">
      {% for category_page in series.most_recent(5) %}
        {% with info = category_page.series_info() %}
        <li class="list-group-item">
          <a href="{{url_for(category_page)}}">{{info.title}}</a>
        </li>
        {% endwith %}
      {% endfor %}
    </ul>
  </div>
  {% endif %}
{% endwith %}
{%- endmacro %}

{% macro pages(pages, limit=10) -%}
  {% for page in syndicated_pages(pages, limit=limit) %}
  {{inline_page(page)}}
  {% endfor %}
{%- endmacro %}

{% macro archive(pages) -%}
<ul class="list-group">
  {% for page in syndicated_pages(pages) %}
  <li class="list-group-item"><a href="{{url_for(page)}}">{{page.meta.date.strftime("%Y-%m-%d")}} - {{page.meta.title}}</a></li>
  {% endfor %}
</ul>
{%- endmacro %}
